{{>header}}
<div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
        <!-- Menu -->

        <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
            <div class="app-brand demo">
                <a href="/chat" class="app-brand-link">
                    <span class="app-brand-text demo menu-text fw-bold">Chat</span>
                </a>

                <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto">
                    <i class="ti menu-toggle-icon d-none d-xl-block ti-sm align-middle"></i>
                    <i class="ti ti-x d-block d-xl-none ti-sm align-middle"></i>
                </a>
            </div>

            <div class="menu-inner-shadow"></div>

            <ul class="menu-inner py-1">
                <!-- Apps & Pages -->
                <li class="menu-header small text-uppercase">
                    <span class="menu-header-text"></span>
                </li>
                <li class="menu-item">
                    <a href="/profile" class="menu-link">
                        <i class="menu-icon tf-icons ti ti-user"></i>
                        <div data-i18n="Profile">Profile</div>
                    </a>
                </li>
                <li class="menu-item active">
                    <a href="/chat" class="menu-link">
                        <i class="menu-icon tf-icons ti ti-messages"></i>
                        <div data-i18n="Chat">Chat</div>
                    </a>
                </li>
            </ul>
        </aside>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
            <!-- Navbar -->

            <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
                id="layout-navbar">
                <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
                    <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
                        <i class="ti ti-menu-2 ti-sm"></i>
                    </a>
                </div>

                <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">


                    <ul class="navbar-nav flex-row align-items-center ms-auto">

                        <!-- Style Switcher -->
                        <li class="nav-item me-2 me-xl-0">
                            <a class="nav-link style-switcher-toggle hide-arrow" href="javascript:void(0);">
                                <i class="ti ti-md"></i>
                            </a>
                        </li>
                        <!--/ Style Switcher -->

                        <!-- User -->
                        <li class="nav-item navbar-dropdown dropdown-user dropdown">
                            <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);"
                                data-bs-toggle="dropdown">
                                <div class="avatar avatar-online">
                                    <img src="../../assets/img/avatars/1.png" alt class="h-auto rounded-circle" />
                                </div>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                    <a class="dropdown-item" href="pages-account-settings-account.html">
                                        <div class="d-flex">
                                            <div class="flex-shrink-0 me-3">
                                                <div class="avatar avatar-online">
                                                    <img src="../../assets/img/avatars/1.png" alt
                                                        class="h-auto rounded-circle" />
                                                </div>
                                            </div>
                                            <div class="flex-grow-1">
                                                <span class="fw-semibold d-block">John Doe</span>
                                                <small class="text-muted">Admin</small>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <div class="dropdown-divider"></div>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="/profile">
                                        <i class="ti ti-user-check me-2 ti-sm"></i>
                                        <span class="align-middle">My Profile</span>
                                    </a>
                                </li>

                                <li>
                                    <a class="dropdown-item" href="/logout">
                                        <i class="ti ti-logout me-2 ti-sm"></i>
                                        <span class="align-middle">Log Out</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <!--/ User -->
                    </ul>
                </div>

                <!-- Search Small Screens -->
            </nav>

            <!-- / Navbar -->

            <!-- Content wrapper -->
            <div class="content-wrapper">
                <!-- Content -->

                <div class="container-xxl flex-grow-1 container-p-y">
                    <div class="app-chat card overflow-hidden">
                        <div class="row g-0">
                            <!-- Sidebar Left -->
                            <div class="col app-chat-sidebar-left app-sidebar overflow-hidden"
                                id="app-chat-sidebar-left">
                                <div
                                    class="chat-sidebar-left-user sidebar-header d-flex flex-column justify-content-center align-items-center flex-wrap px-4 pt-5">
                                    <div class="avatar avatar-xl avatar-online">
                                        <img src="../../assets/img/avatars/1.png" alt="Avatar" class="rounded-circle" />
                                    </div>
                                    <h5 class="mt-2 mb-0">John Doe</h5>
                                    <small>Admin</small>
                                    <i class="ti ti-x ti-sm cursor-pointer close-sidebar" data-bs-toggle="sidebar"
                                        data-overlay data-target="#app-chat-sidebar-left"></i>
                                </div>
                                <div class="sidebar-body px-4 pb-4">
                                    <div class="my-4">
                                        <p class="text-muted text-uppercase">About</p>
                                        <textarea id="chat-sidebar-left-user-about"
                                            class="form-control chat-sidebar-left-user-about mt-3" rows="4"
                                            maxlength="120">
Dessert chocolate cake lemon drops jujubes. Biscuit cupcake ice cream bear claw brownie brownie marshmallow.</textarea>
                                    </div>
                                    <div class="my-4">
                                        <p class="text-muted text-uppercase">Status</p>
                                        <div class="d-grid gap-1">
                                            <div class="form-check form-check-success">
                                                <input name="chat-user-status" class="form-check-input" type="radio"
                                                    value="active" id="user-active" checked />
                                                <label class="form-check-label" for="user-active">Active</label>
                                            </div>
                                            <div class="form-check form-check-danger">
                                                <input name="chat-user-status" class="form-check-input" type="radio"
                                                    value="busy" id="user-busy" />
                                                <label class="form-check-label" for="user-busy">Busy</label>
                                            </div>
                                            <div class="form-check form-check-warning">
                                                <input name="chat-user-status" class="form-check-input" type="radio"
                                                    value="away" id="user-away" />
                                                <label class="form-check-label" for="user-away">Away</label>
                                            </div>
                                            <div class="form-check form-check-secondary">
                                                <input name="chat-user-status" class="form-check-input" type="radio"
                                                    value="offline" id="user-offline" />
                                                <label class="form-check-label" for="user-offline">Offline</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="my-4">
                                        <p class="text-muted text-uppercase">Settings</p>
                                        <ul class="list-unstyled d-grid gap-2 me-3">
                                            <li class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <i class="ti ti-message me-1"></i>
                                                    <span class="align-middle">Two-step Verification</span>
                                                </div>
                                                <label class="switch switch-primary me-4">
                                                    <input type="checkbox" class="switch-input" checked="" />
                                                    <span class="switch-toggle-slider">
                                                        <span class="switch-on"></span>
                                                        <span class="switch-off"></span>
                                                    </span>
                                                </label>
                                            </li>
                                            <li class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <i class="ti ti-bell me-1"></i>
                                                    <span class="align-middle">Notification</span>
                                                </div>
                                                <label class="switch switch-primary me-4">
                                                    <input type="checkbox" class="switch-input" />
                                                    <span class="switch-toggle-slider">
                                                        <span class="switch-on"></span>
                                                        <span class="switch-off"></span>
                                                    </span>
                                                </label>
                                            </li>
                                            <li>
                                                <i class="ti ti-user-plus me-1"></i>
                                                <span class="align-middle">Invite Friends</span>
                                            </li>
                                            <li>
                                                <i class="ti ti-trash me-1"></i>
                                                <span class="align-middle">Delete Account</span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="d-flex mt-4">
                                        <button class="btn btn-primary" data-bs-toggle="sidebar" data-overlay
                                            data-target="#app-chat-sidebar-left">
                                            Logout
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!-- /Sidebar Left-->

                            <!-- Chat & Contacts -->
                            <div class="col app-chat-contacts app-sidebar flex-grow-0 overflow-hidden border-end"
                                id="app-chat-contacts">
                                <div class="sidebar-header">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0 avatar avatar-online me-3" data-bs-toggle="sidebar"
                                            data-overlay="app-overlay-ex" data-target="#app-chat-sidebar-left">
                                            <img class="user-avatar rounded-circle cursor-pointer"
                                                src="{{ currentUser.profileImage }}" alt="Avatar" />
                                        </div>
                                        <div class="flex-grow-1 input-group input-group-merge rounded-pill">
                                            {{ currentUser.name }}
                                        </div>
                                    </div>
                                    <i class="ti ti-x cursor-pointer close-sidebar d-lg-none d-block position-absolute top-0 end-0"
                                        data-overlay data-bs-toggle="sidebar" data-target="#app-chat-contacts"></i>
                                </div>
                                <hr class="container-m-nx m-0" />
                                <div class="sidebar-body">
                                    <div class="chat-contact-list-item-title">
                                        <h5 class="text-primary mb-0 px-4 pt-3 pb-2">Chats</h5>
                                    </div>
                                    <!-- Chats -->
                                    <ul class="list-unstyled chat-contact-list" id="chat-list">
                                        {{#each users }}
                                        <li class="chat-contact-list-item" onclick="chatBox('{{_id}}')">
                                            <a class="d-flex align-items-center">
                                                <div class="flex-shrink-0 avatar avatar-{{status}}">
                                                    <img src="{{ currentUser.profileImage }}" alt="Avatar"
                                                        class="rounded-circle" />
                                                </div>
                                                <div class="chat-contact-info flex-grow-1 ms-2">
                                                    <h6 class="chat-contact-name text-truncate m-0">{{ currentUser.name
                                                        }}</h6>
                                                </div>
                                            </a>
                                        </li>
                                        {{/each}}

                                    </ul>
                                    <!-- Contacts -->
                                </div>
                            </div>
                            <!-- /Chat contacts -->

                            <!-- Chat History -->
                            <div class="col app-chat-history bg-body">
                                <div class="chat-history-wrapper">
                                    <div class="chat-history-header border-bottom">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="d-flex overflow-hidden align-items-center">
                                                <i class="ti ti-menu-2 ti-sm cursor-pointer d-lg-none d-block me-2"
                                                    data-bs-toggle="sidebar" data-overlay
                                                    data-target="#app-chat-contacts"></i>
                                                <div class="flex-shrink-0 avatar">
                                                    <img src="../../assets/img/avatars/2.png" alt="Avatar"
                                                        class="rounded-circle" id="current-chat-image" />

                                                </div>
                                                <div class="chat-contact-info flex-grow-1 ms-2">
                                                    <h6 class="m-0" id="current-chat-name">Felecia Rower</h6>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="chat-history-body bg-body">
                                        <ul class="list-unstyled chat-history" id="chatMessageBox">
                                            {{!-- <li class="chat-message chat-message-right">
                                                <div class="d-flex overflow-hidden">
                                                    <div class="chat-message-wrapper flex-grow-1">
                                                        <div class="chat-message-text">
                                                            <p class="mb-0">How can we help? We're here for you! 😄</p>
                                                        </div>
                                                        <div class="text-end text-muted mt-1">
                                                            <i class="ti ti-checks ti-xs me-1 text-success"></i>
                                                            <small>10:00 AM</small>
                                                        </div>
                                                    </div>
                                                    <div class="user-avatar flex-shrink-0 ms-3">
                                                        <div class="avatar avatar-sm">
                                                            <img src="../../assets/img/avatars/1.png" alt="Avatar"
                                                                class="rounded-circle" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="chat-message">
                                                <div class="d-flex overflow-hidden">
                                                    <div class="user-avatar flex-shrink-0 me-3">
                                                        <div class="avatar avatar-sm">
                                                            <img src="../../assets/img/avatars/2.png" alt="Avatar"
                                                                class="rounded-circle" />
                                                        </div>
                                                    </div>
                                                    <div class="chat-message-wrapper flex-grow-1">
                                                        <div class="chat-message-text">
                                                            <p class="mb-0">Hey John, I am looking for the best admin
                                                                template.</p>
                                                            <p class="mb-0">Could you please help me to find it out? 🤔
                                                            </p>
                                                        </div>
                                                        <div class="chat-message-text mt-2">
                                                            <p class="mb-0">It should be Bootstrap 5 compatible.</p>
                                                        </div>
                                                        <div class="text-muted mt-1">
                                                            <small>10:02 AM</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="chat-message chat-message-right">
                                                <div class="d-flex overflow-hidden">
                                                    <div class="chat-message-wrapper flex-grow-1">
                                                        <div class="chat-message-text">
                                                            <p class="mb-0">Vuexy has all the components you'll ever
                                                                need in a app.</p>
                                                        </div>
                                                        <div class="text-end text-muted mt-1">
                                                            <i class="ti ti-checks ti-xs me-1 text-success"></i>
                                                            <small>10:03 AM</small>
                                                        </div>
                                                    </div>
                                                    <div class="user-avatar flex-shrink-0 ms-3">
                                                        <div class="avatar avatar-sm">
                                                            <img src="../../assets/img/avatars/1.png" alt="Avatar"
                                                                class="rounded-circle" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="chat-message">
                                                <div class="d-flex overflow-hidden">
                                                    <div class="user-avatar flex-shrink-0 me-3">
                                                        <div class="avatar avatar-sm">
                                                            <img src="../../assets/img/avatars/2.png" alt="Avatar"
                                                                class="rounded-circle" />
                                                        </div>
                                                    </div>
                                                    <div class="chat-message-wrapper flex-grow-1">
                                                        <div class="chat-message-text">
                                                            <p class="mb-0">Looks clean and fresh UI. 😃</p>
                                                        </div>
                                                        <div class="chat-message-text mt-2">
                                                            <p class="mb-0">It's perfect for my next project.</p>
                                                        </div>
                                                        <div class="chat-message-text mt-2">
                                                            <p class="mb-0">How can I purchase it?</p>
                                                        </div>
                                                        <div class="text-muted mt-1">
                                                            <small>10:05 AM</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="chat-message chat-message-right">
                                                <div class="d-flex overflow-hidden">
                                                    <div class="chat-message-wrapper flex-grow-1">
                                                        <div class="chat-message-text">
                                                            <p class="mb-0">Thanks, you can purchase it.</p>
                                                        </div>
                                                        <div class="text-end text-muted mt-1">
                                                            <i class="ti ti-checks ti-xs me-1 text-success"></i>
                                                            <small>10:06 AM</small>
                                                        </div>
                                                    </div>
                                                    <div class="user-avatar flex-shrink-0 ms-3">
                                                        <div class="avatar avatar-sm">
                                                            <img src="../../assets/img/avatars/1.png" alt="Avatar"
                                                                class="rounded-circle" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="chat-message">
                                                <div class="d-flex overflow-hidden">
                                                    <div class="user-avatar flex-shrink-0 me-3">
                                                        <div class="avatar avatar-sm">
                                                            <img src="../../assets/img/avatars/2.png" alt="Avatar"
                                                                class="rounded-circle" />
                                                        </div>
                                                    </div>
                                                    <div class="chat-message-wrapper flex-grow-1">
                                                        <div class="chat-message-text">
                                                            <p class="mb-0">I will purchase it for sure. 👍</p>
                                                        </div>
                                                        <div class="chat-message-text mt-2">
                                                            <p class="mb-0">Thanks.</p>
                                                        </div>
                                                        <div class="text-muted mt-1">
                                                            <small>10:08 AM</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="chat-message chat-message-right">
                                                <div class="d-flex overflow-hidden">
                                                    <div class="chat-message-wrapper flex-grow-1">
                                                        <div class="chat-message-text">
                                                            <p class="mb-0">Great, Feel free to get in touch.</p>
                                                        </div>
                                                        <div class="text-end text-muted mt-1">
                                                            <i class="ti ti-checks ti-xs me-1 text-success"></i>
                                                            <small>10:10 AM</small>
                                                        </div>
                                                    </div>
                                                    <div class="user-avatar flex-shrink-0 ms-3">
                                                        <div class="avatar avatar-sm">
                                                            <img src="../../assets/img/avatars/1.png" alt="Avatar"
                                                                class="rounded-circle" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="chat-message">
                                                <div class="d-flex overflow-hidden">
                                                    <div class="user-avatar flex-shrink-0 me-3">
                                                        <div class="avatar avatar-sm">
                                                            <img src="../../assets/img/avatars/2.png" alt="Avatar"
                                                                class="rounded-circle" />
                                                        </div>
                                                    </div>
                                                    <div class="chat-message-wrapper flex-grow-1">
                                                        <div class="chat-message-text">
                                                            <p class="mb-0">Do you have design files for Vuexy?</p>
                                                        </div>
                                                        <div class="text-muted mt-1">
                                                            <small>10:15 AM</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="chat-message chat-message-right">
                                                <div class="d-flex overflow-hidden">
                                                    <div class="chat-message-wrapper flex-grow-1 w-50">
                                                        <div class="chat-message-text">
                                                            <p class="mb-0">
                                                                Yes that's correct documentation file, Design files are
                                                                included with the template.
                                                            </p>
                                                        </div>
                                                        <div class="text-end text-muted mt-1">
                                                            <i class="ti ti-checks ti-xs me-1"></i>
                                                            <small>10:15 AM</small>
                                                        </div>
                                                    </div>
                                                    <div class="user-avatar flex-shrink-0 ms-3">
                                                        <div class="avatar avatar-sm">
                                                            <img src="../../assets/img/avatars/1.png" alt="Avatar"
                                                                class="rounded-circle" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </li> --}}
                                        </ul>
                                    </div>
                                    <!-- Chat message form -->
                                    <div class="chat-history-footer shadow-sm">
                                        <form id="send-chat-message"
                                            class="form-send-message d-flex justify-content-between align-items-center">
                                            <input class="form-control message-input border-0 me-3 shadow-none"
                                                placeholder="Type your message here" />
                                            <div class="message-actions d-flex align-items-center">
                                                <button class="btn btn-primary d-flex send-msg-btn">
                                                    <i class="ti ti-send me-md-1 me-0"></i>
                                                    <span class="align-middle d-md-inline-block d-none">Send</span>
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!-- /Chat History -->

                            <!-- Sidebar Right -->
                            <div class="col app-chat-sidebar-right app-sidebar overflow-hidden"
                                id="app-chat-sidebar-right">
                                <div
                                    class="sidebar-header d-flex flex-column justify-content-center align-items-center flex-wrap px-4 pt-5">
                                    <div class="avatar avatar-xl avatar-online">
                                        <img src="../../assets/img/avatars/2.png" alt="Avatar" class="rounded-circle" />
                                    </div>
                                    <h6 class="mt-2 mb-0">Felecia Rower</h6>
                                    <span>NextJS Developer</span>
                                    <i class="ti ti-x ti-sm cursor-pointer close-sidebar d-block"
                                        data-bs-toggle="sidebar" data-overlay data-target="#app-chat-sidebar-right"></i>
                                </div>
                                <div class="sidebar-body px-4 pb-4">
                                    <div class="my-4">
                                        <p class="text-muted text-uppercase">About</p>
                                        <p class="mb-0 mt-3">
                                            A Next. js developer is a software developer who uses the Next. js framework
                                            alongside ReactJS
                                            to build web applications.
                                        </p>
                                    </div>
                                    <div class="my-4">
                                        <p class="text-muted text-uppercase">Personal Information</p>
                                        <ul class="list-unstyled d-grid gap-2 mt-3">
                                            <li>
                                                <i class="ti ti-mail"></i>
                                                <span class="align-middle ms-2">josephGreen@email.com</span>
                                            </li>
                                            <li>
                                                <i class="ti ti-phone-call"></i>
                                                <span class="align-middle ms-2">+1(123) 456 - 7890</span>
                                            </li>
                                            <li>
                                                <i class="ti ti-clock"></i>
                                                <span class="align-middle ms-2">Mon - Fri 10AM - 8PM</span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="mt-4">
                                        <p class="text-muted text-uppercase">Options</p>
                                        <ul class="list-unstyled d-grid gap-2 mt-3">
                                            <li class="cursor-pointer">
                                                <i class="ti ti-badge"></i>
                                                <span class="align-middle ms-2">Add Tag</span>
                                            </li>
                                            <li class="cursor-pointer">
                                                <i class="ti ti-star"></i>
                                                <span class="align-middle ms-2">Important Contact</span>
                                            </li>
                                            <li class="cursor-pointer">
                                                <i class="ti ti-photo"></i>
                                                <span class="align-middle ms-2">Shared Media</span>
                                            </li>
                                            <li class="cursor-pointer">
                                                <i class="ti ti-trash"></i>
                                                <span class="align-middle ms-2">Delete Contact</span>
                                            </li>
                                            <li class="cursor-pointer">
                                                <i class="ti ti-ban"></i>
                                                <span class="align-middle ms-2">Block Contact</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="app-overlay"></div>
                        </div>
                    </div>
                </div>

                <footer class="content-footer footer bg-footer-theme">
                    <div class="container-xxl">
                        <div
                            class="footer-container d-flex align-items-center justify-content-between py-2 flex-md-row flex-column">
                            <div>
                                ©
                                <script>
                                    document.write(new Date().getFullYear());
                                </script>
                            </div>
                        </div>
                    </div>
                </footer>

                <div class="content-backdrop fade"></div>
            </div>
            <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
    </div>

    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>

    <!-- Drag Target Area To SlideIn Menu On Small Screens -->
    <div class="drag-target"></div>
</div>

{{>footer}}

<script src="/assets/js/app-chat.js" defer></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    var socket = io();
    let allUsers = [];
    const chatList = document.getElementById('chat-list')
    const chatMessageBox = document.getElementById('chatMessageBox')
    let currentChatUser = {};
    const currentUser = "{{currentUser._id}}"

    socket.on('user-connected', (data) => {
        allUsers = data;
        chatList.innerHTML = "",
            data.forEach(d => {
                if (currentUser !== d._id) {
                    let list = document.createElement('li')
                    list.className = "chat-contact-list-item"
                    list.onclick = function () {
                        chatBox(d._id)
                    }
                    list.innerHTML = `<a class="d-flex align-items-center">
                                      <div class="flex-shrink-0 avatar avatar-${d.status}">
                                <img src="${d.profileImage}" alt="Avatar" class="rounded-circle" />
                                </div>
                             <div class="chat-contact-info flex-grow-1 ms-2">
                              <h6 class="chat-contact-name text-truncate m-0">${d.name}</h6>
                             </div>
                        </a>`
                    chatList.append(list)
                }

            })

    })
    //disconnected ------
    socket.on('user-disconnected', (data) => {
        allUsers = data
        chatList.innerHTML = "";
            data.forEach(d => {
                if (currentUser !== d._id) {
                    let list = document.createElement('li')
                    list.className = "chat-contact-list-item"
                    list.onclick = function () {
                        chatBox(d._id)
                    }
                    list.innerHTML = `<a class="d-flex align-items-center">
                                      <div class="flex-shrink-0 avatar avatar-${d.status}">
                                <img src="${d.profileImage}" alt="Avatar" class="rounded-circle" />
                                </div>
                             <div class="chat-contact-info flex-grow-1 ms-2">
                              <h6 class="chat-contact-name text-truncate m-0">${d.name}</h6>
                             </div>
                        </a>`
                    chatList.append(list)
                }

            })

    })
    function chatBox(id) {
        currentChatUser = allUsers.find((user) => user._id === id);
        //console.log(chatUser)

        let chatUserImage = document.getElementById("current-chat-image")
        let chatUserName = document.getElementById("current-chat-name")

        chatUserImage.src = currentChatUser.profileImage
        chatUserName.innerText = currentChatUser.name
        chatList.innerHTML = "";
        socket.emit('get-chat-messages', {
            currentUser: currentUser,
            currentChatUser: currentChatUser._id

        })
        socket.on('send-chat-messages', (data) => {
            if (data.length === 0) {
                chatMessageBox.innerHTML = "";
                
            } else {
                chatList.innerHTML = "";
                data.forEach((value) => {
                    if (value.sender === currentUser) {
                        let li = document.createElement('li')
                        li.className = 'chat-message chat-message-right';
                        li.innerHTML = `
                        <div class="d-flex overflow-hidden">
                                                    <div class="chat-message-wrapper flex-grow-1">
                                                        <div class="chat-message-text">
                                                            <p class="mb-0">${value.message}</p>
                                                        </div>
                                                        <div class="text-end text-muted mt-1">
                                                            <i class="ti ti-checks ti-xs me-1 text-success"></i>
                                                            <small>15:11</small>
                                                        </div>
                                                    </div>
                                                </div> `

                        chatMessageBox.append(li)
                        chatHistoryBody.scrollTo(0, chatHistoryBody.scrollHeight);

                    } else {
                        let li = document.createElement('li')
                        li.className = 'chat-message';
                        li.innerHTML = `
                        <div class="d-flex overflow-hidden">
                                                    <div class="chat-message-wrapper flex-grow-1">
                                                        <div class="chat-message-text">
                                                            <p class="mb-0">${value.message}</p>
                                                        </div>
                                                        <div class="text-end text-muted mt-1">
                                                            <i class="ti ti-checks ti-xs me-1 text-success"></i>
                                                            <small>15:11</small>
                                                        </div>
                                                    </div>                                                    
                                                </div> `

                        chatMessageBox.append(li)
                        chatHistoryBody.scrollTo(0, chatHistoryBody.scrollHeight);
                    }
                })
            }
        })
        socket.on('reload-chat-messages', () => {
            socket.emit('get-chat-messages', {
                currentUser: currentUser,
                currentChatUser: currentChatUser
            })
        })
    }

    const sendChatMessage = document.getElementById('send-chat-message')

    messageInput = document.querySelector('.message-input');
    chatHistoryBody = document.querySelector('.chat-history-body')
    sendChatMessage.addEventListener('submit', e => {
        e.preventDefault();
        if (messageInput.value) {

            socket.emit('create-chat-message', {
                sender: currentUser,
                receiver: currentChatUser._id,
                from: 'sender',
                to: 'receiver',
                message: messageInput.value

            })


            messageInput.value = ''
        }
    });

</script>
function scrollToBottom() {

}
scrollToBottom();